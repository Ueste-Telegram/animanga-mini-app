<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AniManga Tracker Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        :root {
            --primary: #6772e5;
            --secondary: #24b47e;
            --danger: #f0616d;
            --warning: #ffc53d;
            --bg-primary: var(--tg-theme-bg-color, #ffffff);
            --bg-secondary: var(--tg-theme-secondary-bg-color, #f4f4f5);
            --text-primary: var(--tg-theme-text-color, #000000);
            --text-secondary: var(--tg-theme-hint-color, #666666);
        }
        
        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 0;
            min-height: 100vh;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 16px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: 20px;
            color: white;
            margin: 16px;
            margin-bottom: 24px;
        }
        
        .header h1 {
            font-size: 24px;
            margin-bottom: 8px;
            font-weight: 700;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .tabs {
            display: flex;
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 6px;
            margin: 0 16px 20px;
            gap: 4px;
        }
        
        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .tab.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-weight: 600;
        }
        
        .search-box {
            margin: 0 16px 20px;
            position: relative;
        }
        
        .search-input {
            width: 100%;
            padding: 14px 45px 14px 16px;
            border: none;
            border-radius: 16px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
        }
        
        .search-icon {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
        }
        
        .filters {
            display: flex;
            gap: 8px;
            margin: 0 16px 16px;
            overflow-x: auto;
            padding-bottom: 8px;
        }
        
        .filter-chip {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-radius: 20px;
            font-size: 14px;
            white-space: nowrap;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-chip.active {
            background: var(--primary);
            color: white;
        }
        
        .manga-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 16px;
            padding: 0 16px;
        }
        
        .manga-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
        }
        
        .manga-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .manga-cover {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }
        
        .manga-info {
            padding: 12px;
        }
        
        .manga-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 6px;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .manga-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 6px;
        }
        
        .manga-rating {
            color: #ffd700;
            font-size: 12px;
        }
        
        .manga-status {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            background: var(--primary);
            color: white;
        }
        
        .manga-genres {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 6px;
        }
        
        .genre-tag {
            font-size: 9px;
            padding: 2px 6px;
            background: rgba(103, 114, 229, 0.1);
            color: var(--primary);
            border-radius: 8px;
        }
        
        .add-fab {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 8px 25px rgba(103, 114, 229, 0.3);
            cursor: pointer;
            border: none;
            z-index: 1000;
            transition: transform 0.2s;
        }
        
        .add-fab:active {
            transform: scale(0.95);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--bg-primary);
            border-radius: 24px 24px 0 0;
            padding: 24px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
        }
        
        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--bg-secondary);
            border-radius: 12px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            transition: border-color 0.2s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--primary);
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
            width: 100%;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        .genre-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }
        
        .genre-option {
            padding: 8px 16px;
            background: var(--bg-secondary);
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .genre-option.selected {
            background: var(--primary);
            color: white;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }
        
        .empty-state img {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéå AniManga Tracker Pro</h1>
            <p>–¢–≤–æ–π –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —Ç—Ä–µ–∫–µ—Ä –∞–Ω–∏–º–µ –∏ –º–∞–Ω–≥–∏</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('manga')">üìö –ú–∞–Ω–≥–∞</div>
            <div class="tab" onclick="showTab('anime')">üé¨ –ê–Ω–∏–º–µ</div>
            <div class="tab" onclick="showTab('search')">üîç –ü–æ–∏—Å–∫</div>
            <div class="tab" onclick="showTab('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ú–∞–Ω–≥–∞ -->
        <div id="manga-tab" class="tab-content">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –º–∞–Ω–≥–∏..." oninput="searchManga(this.value)">
                <div class="search-icon">üîç</div>
            </div>
            
            <div class="filters">
                <div class="filter-chip active" onclick="setFilter('all')">–í—Å–µ</div>
                <div class="filter-chip" onclick="setFilter('reading')">–ß–∏—Ç–∞—é</div>
                <div class="filter-chip" onclick="setFilter('planned')">–í –ø–ª–∞–Ω–∞—Ö</div>
                <div class="filter-chip" onclick="setFilter('completed')">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</div>
                <div class="filter-chip" onclick="setFilter('dropped')">–ë—Ä–æ—à–µ–Ω–æ</div>
            </div>
            
            <div id="manga-list" class="manga-grid">
                <!-- –ú–∞–Ω–≥–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ê–Ω–∏–º–µ -->
        <div id="anime-tab" class="tab-content" style="display: none;">
            <div class="empty-state">
                <div style="font-size: 48px;">üé¨</div>
                <h3>–†–∞–∑–¥–µ–ª –∞–Ω–∏–º–µ</h3>
                <p>–°–∫–æ—Ä–æ –ø–æ—è–≤–∏—Ç—Å—è! –†–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ —ç—Ç–∏–º üöÄ</p>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ü–æ–∏—Å–∫ -->
        <div id="search-tab" class="tab-content" style="display: none;">
            <div class="search-box">
                <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –±–∞–∑–∞–º..." oninput="searchDatabase(this.value)">
                <div class="search-icon">üîç</div>
            </div>
            
            <div id="search-results" class="manga-grid">
                <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ -->
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ü—Ä–æ—Ñ–∏–ª—å -->
        <div id="profile-tab" class="tab-content" style="display: none;">
            <div class="empty-state">
                <div style="font-size: 48px;">üìä</div>
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
                <p>–î–æ–±–∞–≤—å –º–∞–Ω–≥—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É!</p>
            </div>
        </div>
    </div>
    
    <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <button class="add-fab" onclick="showAddModal()">+</button>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
    <div id="add-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">–î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω–≥—É</h2>
                <button class="close-btn" onclick="hideAddModal()">√ó</button>
            </div>
            
            <form onsubmit="addManga(event)">
                <div class="form-group">
                    <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="form-input" id="manga-title" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–°—Ç–∞—Ç—É—Å</label>
                    <select class="form-select" id="manga-status" required>
                        <option value="reading">–ß–∏—Ç–∞—é</option>
                        <option value="planned">–í –ø–ª–∞–Ω–∞—Ö</option>
                        <option value="completed">–ü—Ä–æ—á–∏—Ç–∞–Ω–æ</option>
                        <option value="dropped">–ë—Ä–æ—à–µ–Ω–æ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–†–µ–π—Ç–∏–Ω–≥</label>
                    <select class="form-select" id="manga-rating">
                        <option value="0">–ë–µ–∑ –æ—Ü–µ–Ω–∫–∏</option>
                        <option value="1">‚≠ê</option>
                        <option value="2">‚≠ê‚≠ê</option>
                        <option value="3">‚≠ê‚≠ê‚≠ê</option>
                        <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê</option>
                        <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</label>
                    <div style="display: flex; gap: 12px;">
                        <input type="number" class="form-input" id="manga-volumes" placeholder="–¢–æ–º–∞" min="0">
                        <input type="number" class="form-input" id="manga-chapters" placeholder="–ì–ª–∞–≤—ã" min="0">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–ñ–∞–Ω—Ä—ã</label>
                    <div class="genre-selector" id="genre-selector">
                        <div class="genre-option" onclick="toggleGenre(this)">–°—ë–Ω—ç–Ω</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–°—ë–¥–∑—ë</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–§—ç–Ω—Ç–µ–∑–∏</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–†–æ–º–∞–Ω—Ç–∏–∫–∞</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–ö–æ–º–µ–¥–∏—è</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–î—Ä–∞–º–∞</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–≠–∫—à–µ–Ω</div>
                        <div class="genre-option" onclick="toggleGenre(this)">–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">–¢–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
                    <input type="text" class="form-input" id="manga-tags" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: –∫–ª–∞—Å—Å–∏–∫–∞, —Ç–µ–º–Ω–æ–µ —Ñ—ç–Ω—Ç–µ–∑–∏">
                </div>
                
                <div class="form-group">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <textarea class="form-textarea" id="manga-description" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea>
                </div>
                
                <button type="submit" class="btn btn-primary">–î–æ–±–∞–≤–∏—Ç—å –º–∞–Ω–≥—É</button>
            </form>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let currentUser = null;
        let userManga = [];
        let currentFilter = 'all';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        tg.expand();
        tg.enableClosingConfirmation();
        tg.BackButton.show();
        tg.BackButton.onClick(() => tg.close());
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function initUser() {
            currentUser = tg.initDataUnsafe?.user?.id || 'demo_user';
            loadUserData();
        }
        
        function loadUserData() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ API
            // –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            userManga = [
                {
                    id: 1,
                    title: "–ë–µ—Ä—Å–µ—Ä–∫",
                    status: "reading",
                    rating: 5,
                    genres: ["–§—ç–Ω—Ç–µ–∑–∏", "–£–∂–∞—Å—ã", "–î—Ä–∞–º–∞"],
                    tags: ["dark", "classic", "berserk"],
                    progress: { volumes: 12, chapters: 347 },
                    description: "–ú—Ä–∞—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –æ –≤–æ–∏–Ω–µ –ì–∞—Ç—Å–µ –∏ –µ–≥–æ –±–æ—Ä—å–±–µ —Å —Å—É–¥—å–±–æ–π."
                },
                {
                    id: 2,
                    title: "–í–∞–Ω –ü–∏—Å",
                    status: "reading", 
                    rating: 4,
                    genres: ["–°—ë–Ω—ç–Ω", "–ö–æ–º–µ–¥–∏—è", "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è"],
                    tags: ["pirate", "adventure", "long-running"],
                    progress: { volumes: 0, chapters: 108 },
                    description: "–ü—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –õ—É—Ñ—Ñ–∏ –∏ –µ–≥–æ –∫–æ–º–∞–Ω–¥—ã –≤ –ø–æ–∏—Å–∫–∞—Ö –≤–µ–ª–∏—á–∞–π—à–µ–≥–æ —Å–æ–∫—Ä–æ–≤–∏—â–∞."
                },
                {
                    id: 3,
                    title: "–ê—Ç–∞–∫–∞ —Ç–∏—Ç–∞–Ω–æ–≤",
                    status: "completed",
                    rating: 5,
                    genres: ["–°—ë–Ω—ç–Ω", "–î—Ä–∞–º–∞", "–≠–∫—à–µ–Ω"],
                    tags: ["titans", "post-apocalyptic", "epic"],
                    progress: { volumes: 34, chapters: 0 },
                    description: "–ë–æ—Ä—å–±–∞ —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤–∞ –ø—Ä–æ—Ç–∏–≤ –≥–∏–≥–∞–Ω—Ç—Å–∫–∏—Ö —Ç–∏—Ç–∞–Ω–æ–≤."
                }
            ];
            renderMangaList();
        }
        
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').style.display = 'block';
            event.target.classList.add('active');
            
            if (tabName === 'manga') {
                renderMangaList();
            }
        }
        
        function setFilter(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-chip').forEach(chip => {
                chip.classList.remove('active');
            });
            event.target.classList.add('active');
            renderMangaList();
        }
        
        function renderMangaList() {
            const mangaList = document.getElementById('manga-list');
            let filteredManga = userManga;
            
            if (currentFilter !== 'all') {
                filteredManga = userManga.filter(manga => manga.status === currentFilter);
            }
            
            if (filteredManga.length === 0) {
                mangaList.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div style="font-size: 48px;">üìö</div>
                        <h3>–°–ø–∏—Å–æ–∫ –ø—É—Å—Ç</h3>
                        <p>–ù–∞–∂–º–∏ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –º–∞–Ω–≥—É</p>
                    </div>
                `;
                return;
            }
            
            mangaList.innerHTML = filteredManga.map(manga => {
                const statusText = {
                    'reading': '–ß–∏—Ç–∞—é',
                    'planned': '–í –ø–ª–∞–Ω–∞—Ö', 
                    'completed': '–ü—Ä–æ—á–∏—Ç–∞–Ω–æ',
                    'dropped': '–ë—Ä–æ—à–µ–Ω–æ'
                }[manga.status];
                
                const statusClass = `status-${manga.status}`;
                
                let progress = '';
                if (manga.progress && (manga.progress.volumes > 0 || manga.progress.chapters > 0)) {
                    progress = `<div class="manga-meta">
                        <span class="manga-rating">${'‚≠ê'.repeat(manga.rating)}</span>
                        <span class="manga-status">${statusText}</span>
                    </div>
                    <div style="font-size: 11px; color: var(--text-secondary);">
                        üìö –¢–æ–º ${manga.progress.volumes} ‚Ä¢ –ì–ª–∞–≤–∞ ${manga.progress.chapters}
                    </div>`;
                }
                
                const genresHTML = manga.genres.slice(0, 2).map(genre => 
                    `<span class="genre-tag">${genre}</span>`
                ).join('');
                
                return `
                    <div class="manga-card" onclick="showMangaDetails(${manga.id})">
                        <div style="background: #ddd; height: 120px; display: flex; align-items: center; justify-content: center; color: #666; font-size: 12px;">
                            üñºÔ∏è –û–±–ª–æ–∂–∫–∞
                        </div>
                        <div class="manga-info">
                            <div class="manga-title">${manga.title}</div>
                            ${progress}
                            <div class="manga-genres">
                                ${genresHTML}
                                ${manga.genres.length > 2 ? `<span class="genre-tag">+${manga.genres.length - 2}</span>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function showAddModal() {
            document.getElementById('add-modal').style.display = 'block';
        }
        
        function hideAddModal() {
            document.getElementById('add-modal').style.display = 'none';
        }
        
        function toggleGenre(element) {
            element.classList.toggle('selected');
        }
        
        function addManga(event) {
            event.preventDefault();
            
            const title = document.getElementById('manga-title').value;
            const status = document.getElementById('manga-status').value;
            const rating = parseInt(document.getElementById('manga-rating').value);
            const volumes = parseInt(document.getElementById('manga-volumes').value) || 0;
            const chapters = parseInt(document.getElementById('manga-chapters').value) || 0;
            const tags = document.getElementById('manga-tags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            const description = document.getElementById('manga-description').value;
            
            const selectedGenres = Array.from(document.querySelectorAll('.genre-option.selected'))
                .map(el => el.textContent);
            
            const newManga = {
                id: userManga.length + 1,
                title,
                status,
                rating,
                genres: selectedGenres,
                tags,
                progress: { volumes, chapters },
                description
            };
            
            userManga.push(newManga);
            renderMangaList();
            hideAddModal();
            
            // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
            event.target.reset();
            document.querySelectorAll('.genre-option.selected').forEach(el => {
                el.classList.remove('selected');
            });
            
            tg.showPopup({
                title: '–£—Å–ø–µ—à–Ω–æ!',
                message: `–ú–∞–Ω–≥–∞ "${title}" –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ –≤–∞—à—É –±–∏–±–ª–∏–æ—Ç–µ–∫—É!`,
                buttons: [{ type: 'ok' }]
            });
        }
        
        function searchManga(query) {
            // –ü—Ä–æ—Å—Ç–æ–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
            const filtered = userManga.filter(manga => 
                manga.title.toLowerCase().includes(query.toLowerCase())
            );
            
            const mangaList = document.getElementById('manga-list');
            if (filtered.length === 0) {
                mangaList.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <div style="font-size: 48px;">üîç</div>
                        <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                        <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å</p>
                    </div>
                `;
                return;
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫
            mangaList.innerHTML = filtered.map(manga => {
                // –¢–æ—Ç –∂–µ –∫–æ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ —á—Ç–æ –∏ –≤ renderMangaList
                return `<div class="manga-card">
                    <div style="background: #ddd; height: 120px; display: flex; align-items: center; justify-content: center; color: #666; font-size: 12px;">
                        üñºÔ∏è –û–±–ª–æ–∂–∫–∞
                    </div>
                    <div class="manga-info">
                        <div class="manga-title">${manga.title}</div>
                        <div class="manga-meta">
                            <span class="manga-rating">${'‚≠ê'.repeat(manga.rating)}</span>
                            <span class="manga-status">${manga.status}</span>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }
        
        function showMangaDetails(mangaId) {
            const manga = userManga.find(m => m.id === mangaId);
            if (manga) {
                tg.showPopup({
                    title: manga.title,
                    message: `–°—Ç–∞—Ç—É—Å: ${manga.status}\n–†–µ–π—Ç–∏–Ω–≥: ${'‚≠ê'.repeat(manga.rating)}\n–ñ–∞–Ω—Ä—ã: ${manga.genres.join(', ')}\n\n${manga.description}`,
                    buttons: [{ type: 'ok' }]
                });
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            initUser();
        });
    </script>
</body>
</html>
